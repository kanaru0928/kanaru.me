{
  "openapi": "3.1.0",
  "info": {
    "title": "Kanaru.me API",
    "version": "1.0.0",
    "description": "Kanaru.me のバックエンドAPIドキュメント"
  },
  "components": {
    "securitySchemes": {
      "InitialBearer": {
        "type": "http",
        "scheme": "bearer",
        "description": "初期Bearer トークンによる認証（/verify エンドポイント用）"
      },
      "Bearer": {
        "type": "http",
        "scheme": "bearer",
        "bearerFormat": "JWT",
        "description": "JWT トークンによる認証"
      }
    },
    "schemas": {
      "ArticleListItem": {
        "type": "object",
        "properties": {
          "slug": {
            "type": "string",
            "example": "my-first-article"
          },
          "title": {
            "type": "string",
            "example": "私の最初の記事"
          },
          "author": {
            "type": "string",
            "example": "山田太郎"
          },
          "status": {
            "type": "string",
            "enum": [
              "published",
              "unpublished"
            ],
            "example": "published"
          },
          "pv": {
            "type": "number",
            "example": 42
          },
          "createdAt": {
            "type": "string",
            "example": "2025-01-01T00:00:00.000Z"
          },
          "updatedAt": {
            "type": "string",
            "example": "2025-01-02T12:34:56.000Z"
          },
          "tags": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "example": [
              "TypeScript",
              "Hono"
            ]
          }
        },
        "required": [
          "slug",
          "title",
          "author",
          "status",
          "pv",
          "createdAt",
          "updatedAt",
          "tags"
        ]
      },
      "Error": {
        "type": "object",
        "properties": {
          "error": {
            "type": "string",
            "example": "Article not found"
          }
        },
        "required": [
          "error"
        ]
      },
      "CreateArticle": {
        "type": "object",
        "properties": {
          "slug": {
            "type": "string",
            "minLength": 1,
            "maxLength": 100
          },
          "title": {
            "type": "string",
            "minLength": 1,
            "maxLength": 200
          },
          "contentBody": {
            "type": "string",
            "minLength": 1
          },
          "author": {
            "type": "string",
            "minLength": 1,
            "maxLength": 100
          },
          "status": {
            "type": "string",
            "enum": [
              "published",
              "unpublished"
            ]
          },
          "tags": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "default": []
          }
        },
        "required": [
          "slug",
          "title",
          "contentBody",
          "author",
          "status"
        ]
      },
      "ArticleDetail": {
        "type": "object",
        "properties": {
          "slug": {
            "type": "string",
            "example": "my-first-article"
          },
          "title": {
            "type": "string",
            "example": "私の最初の記事"
          },
          "author": {
            "type": "string",
            "example": "山田太郎"
          },
          "status": {
            "type": "string",
            "enum": [
              "published",
              "unpublished"
            ],
            "example": "published"
          },
          "pv": {
            "type": "number",
            "example": 42
          },
          "createdAt": {
            "type": "string",
            "example": "2025-01-01T00:00:00.000Z"
          },
          "updatedAt": {
            "type": "string",
            "example": "2025-01-02T12:34:56.000Z"
          },
          "tags": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "example": [
              "TypeScript",
              "Hono"
            ]
          },
          "contentBody": {
            "type": "string",
            "example": "# はじめに\n\nこれは記事本文です。"
          }
        },
        "required": [
          "slug",
          "title",
          "author",
          "status",
          "pv",
          "createdAt",
          "updatedAt",
          "tags",
          "contentBody"
        ]
      },
      "UpdateArticleMetadata": {
        "type": "object",
        "properties": {
          "title": {
            "type": "string",
            "minLength": 1,
            "maxLength": 200
          },
          "author": {
            "type": "string",
            "minLength": 1,
            "maxLength": 100
          },
          "status": {
            "type": "string",
            "enum": [
              "published",
              "unpublished"
            ]
          },
          "tags": {
            "type": "array",
            "items": {
              "type": "string"
            }
          }
        }
      },
      "UpdateArticleContent": {
        "type": "object",
        "properties": {
          "contentBody": {
            "type": "string",
            "minLength": 1
          }
        },
        "required": [
          "contentBody"
        ]
      },
      "DeleteSuccess": {
        "type": "object",
        "properties": {
          "message": {
            "type": "string",
            "example": "Article deleted successfully"
          }
        },
        "required": [
          "message"
        ]
      }
    },
    "parameters": {}
  },
  "paths": {
    "/api/verify": {
      "post": {
        "tags": [
          "Auth"
        ],
        "summary": "JWT トークンを発行",
        "description": "初期Bearer トークンを検証し、成功時にJWT トークンを発行します",
        "security": [
          {
            "InitialBearer": []
          }
        ],
        "responses": {
          "200": {
            "description": "JWT トークンの発行に成功",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "token": {
                      "type": "string",
                      "description": "JWT トークン",
                      "example": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
                    }
                  },
                  "required": [
                    "token"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "認証失敗",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string",
                      "description": "エラーメッセージ",
                      "example": "Unauthorized"
                    }
                  },
                  "required": [
                    "error"
                  ]
                }
              }
            }
          }
        }
      }
    },
    "/api/articles": {
      "get": {
        "tags": [
          "Articles"
        ],
        "summary": "記事一覧を取得",
        "description": "記事の一覧を取得します。認証されていない場合は公開済み記事のみ返却されます。",
        "parameters": [
          {
            "schema": {
              "type": "string"
            },
            "required": false,
            "name": "tag",
            "in": "query"
          },
          {
            "schema": {
              "type": "string",
              "enum": [
                "createdAt",
                "updatedAt"
              ]
            },
            "required": false,
            "name": "sortBy",
            "in": "query"
          },
          {
            "schema": {
              "type": "string",
              "enum": [
                "asc",
                "desc"
              ]
            },
            "required": false,
            "name": "order",
            "in": "query"
          }
        ],
        "responses": {
          "200": {
            "description": "記事一覧の取得に成功",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/ArticleListItem"
                  }
                }
              }
            }
          },
          "500": {
            "description": "サーバーエラー",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          }
        }
      },
      "post": {
        "tags": [
          "Articles"
        ],
        "summary": "記事を作成",
        "description": "新しい記事を作成します（要認証）",
        "security": [
          {
            "Bearer": []
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CreateArticle"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "記事の作成に成功",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ArticleListItem"
                }
              }
            }
          },
          "401": {
            "description": "認証失敗",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "409": {
            "description": "指定されたスラッグの記事が既に存在",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "500": {
            "description": "サーバーエラー",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          }
        }
      }
    },
    "/api/articles/{slug}": {
      "get": {
        "tags": [
          "Articles"
        ],
        "summary": "記事詳細を取得",
        "description": "指定されたスラッグの記事詳細を取得します",
        "parameters": [
          {
            "schema": {
              "type": "string",
              "minLength": 1
            },
            "required": true,
            "name": "slug",
            "in": "path"
          }
        ],
        "responses": {
          "200": {
            "description": "記事詳細の取得に成功",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ArticleDetail"
                }
              }
            }
          },
          "404": {
            "description": "記事が見つからない",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "500": {
            "description": "サーバーエラー",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          }
        }
      },
      "patch": {
        "tags": [
          "Articles"
        ],
        "summary": "記事のメタデータを更新",
        "description": "記事のタイトル、著者、ステータス、タグを更新します（要認証）",
        "security": [
          {
            "Bearer": []
          }
        ],
        "parameters": [
          {
            "schema": {
              "type": "string",
              "minLength": 1
            },
            "required": true,
            "name": "slug",
            "in": "path"
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/UpdateArticleMetadata"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "メタデータの更新に成功",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ArticleListItem"
                }
              }
            }
          },
          "401": {
            "description": "認証失敗",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "404": {
            "description": "記事が見つからない",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "500": {
            "description": "サーバーエラー",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          }
        }
      },
      "delete": {
        "tags": [
          "Articles"
        ],
        "summary": "記事を削除",
        "description": "指定されたスラッグの記事を削除します（要認証）",
        "security": [
          {
            "Bearer": []
          }
        ],
        "parameters": [
          {
            "schema": {
              "type": "string",
              "minLength": 1
            },
            "required": true,
            "name": "slug",
            "in": "path"
          }
        ],
        "responses": {
          "200": {
            "description": "記事の削除に成功",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/DeleteSuccess"
                }
              }
            }
          },
          "401": {
            "description": "認証失敗",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "404": {
            "description": "記事が見つからない",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "500": {
            "description": "サーバーエラー",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          }
        }
      }
    },
    "/api/articles/{slug}/content": {
      "put": {
        "tags": [
          "Articles"
        ],
        "summary": "記事のコンテンツを更新",
        "description": "記事の本文（Markdown）を更新します（要認証）",
        "security": [
          {
            "Bearer": []
          }
        ],
        "parameters": [
          {
            "schema": {
              "type": "string",
              "minLength": 1
            },
            "required": true,
            "name": "slug",
            "in": "path"
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/UpdateArticleContent"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "コンテンツの更新に成功",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ArticleListItem"
                }
              }
            }
          },
          "401": {
            "description": "認証失敗",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "404": {
            "description": "記事が見つからない",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "500": {
            "description": "サーバーエラー",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          }
        }
      }
    }
  },
  "webhooks": {}
}